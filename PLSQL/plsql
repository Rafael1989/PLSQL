#CRIAR USUÁRIO
CREATE USER cursoplsql IDENTIFIED BY cursoplsql
                       DEFAULT tablespace users;
                       
#DAR PERMISSÃO PARA O USUÁRIO
GRANT connect, resource TO cursoplsql;

#CRIAR TABELA
CREATE TABLE SegMercado(ID NUMBER(5),Descricao VARCHAR2(100));
CREATE TABLE Cliente
  ( ID NUMBER(5),
    Razao_Social VARCHAR2(100),
    CNPJ VARCHAR2(20),
    SegMercado_id NUMBER(5),
    Data_Inclusao DATE,
    #8 INTEIRO E 2 DECIMAIS
    Faturamento_Previsto NUMBER(10,2),
    Categoria VARCHAR2(20));

#NÃO DEIXAR ID NULO OU REPETIDO
ALTER TABLE Segmercado ADD CONSTRAINT SegMercado_id_pk PRIMARY KEY(ID);
ALTER TABLE Cliente ADD CONSTRAINT Cliente_id_pk PRIMARY KEY(ID);

#ADICIONA CHAVE ESTRANGEIRA
ALTER TABLE Cliente ADD CONSTRAINT Cliente_SegMercado_fk FOREIGN KEY(SegMercado_id) REFERENCES Segmercado(id) ;

#BLOCO PL/SQL

#LIGA VARIAVEL
SET SERVEROUTPUT ON

#DECLARAR VARIAVEIS
DECLARE
    v_id number(5) := 1;

#INÍCIO DO BLOCO
BEGIN
    v_id := 2;
    
    #IMPRIME NO CONSOLE
    Dbms_output.put_line(v_id);

#FIM DO BLOCO
END;

#BLOCO INSERT PL/SQL
DECLARE
    v_id number(5) := 1;
    v_descricao varchar2(100) := 'varejo';

BEGIN

    INSERT INTO segmercado VALUES (v_id, v_descricao);
    COMMIT;

END;

#BLOC PL/SQL SEM TIPOS(BOA PRÁTICA) + UPPERCASE
DECLARE
    v_id segmercado.id%type := 3;
    v_descricao segmercado.descricao%type := 'atacado';
BEGIN
    INSERT INTO SEGMERCADO VALUES (v_id,upper(v_descricao));
    COMMIT;
END;

#UPDATE
DECLARE
    v_id segmercado.id%type := 1;
    v_descricao segmercado.descricao%type := 'varejista';
BEGIN
    UPDATE SEGMERCADO SET DESCRICAO = UPPER(v_descricao) WHERE id = v_id;
    
    v_id := 2;
    v_descricao := 'atacadista';
    
    UPDATE SEGMERCADO SET DESCRICAO = UPPER(v_descricao) WHERE id = v_id;
    COMMIT;
END;

#DELETE
DECLARE
    v_id segmercado.id%type := 3;
BEGIN
    DELETE FROM SEGMERCADO WHERE id = v_id;
    COMMIT;
END;


#CRIAR PROCEDURE
CREATE PROCEDURE incluir_segmercado(p_id IN NUMBER, p_descricao IN VARCHAR2)
IS
BEGIN
    INSERT INTO SEGMERCADO VALUES(p_id,UPPER(p_descricao));
    COMMIT;
END;


#CRIAR FUNCTION
CREATE OR REPLACE FUNCTION obter_descricao_segmercado (p_id IN segmercado.id%type)
RETURN segmercado.descricao%type

IS
    v_descricao segmercado.descricao%type;

BEGIN
    SELECT descricao INTO v_descricao
        FROM segmercado
        WHERE id = p_id;
    RETURN v_descricao;
END;

#PROCEDURE COM IF
CREATE OR REPLACE PROCEDURE INCLUIR_CLIENTE 
   (p_id in cliente.id%type,
    p_razao_social IN cliente.razao_social%type,
    p_CNPJ cliente.CNPJ%type ,
    p_segmercado_id IN cliente.segmercado_id%type,
    p_faturamento_previsto IN cliente.faturamento_previsto%type)
IS
    v_categoria cliente.categoria%type;

BEGIN

    IF p_faturamento_previsto < 10000 THEN
       v_categoria := 'PEQUENO';
        ELSIF p_faturamento_previsto < 50000 THEN
        v_categoria := 'MEDIO';
        ELSIF p_faturamento_previsto < 100000 THEN
        v_categoria := 'MEDIO GRANDE';
        ELSE
        v_categoria := 'GRANDE';
        END IF;

    INSERT INTO cliente VALUES (p_id, UPPER(p_razao_social), p_CNPJ,p_segmercado_id, SYSDATE, p_faturamento_previsto, v_categoria);
    COMMIT;

END;

#CRIAR FUNCTION
CREATE OR REPLACE FUNCTION categoria_cliente (p_faturamento_previsto IN cliente.faturamento_previsto%type) RETURN cliente.categoria%type

IS
BEGIN

    IF p_faturamento_previsto < 10000 THEN
           RETURN 'PEQUENO';
        ELSIF p_faturamento_previsto < 50000 THEN
            RETURN 'MEDIO';
        ELSIF p_faturamento_previsto < 100000 THEN
            RETURN 'MEDIO GRANDE';
        ELSE
            RETURN 'GRANDE';
        END IF;
END;